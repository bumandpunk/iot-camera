if("undefined"==typeof Promise||Promise.prototype.finally||(Promise.prototype.finally=function(e){const t=this.constructor;return this.then((a=>t.resolve(e()).then((()=>a))),(a=>t.resolve(e()).then((()=>{throw a}))))}),"undefined"!=typeof uni&&uni&&uni.requireGlobal){const e=uni.requireGlobal();ArrayBuffer=e.ArrayBuffer,Int8Array=e.Int8Array,Uint8Array=e.Uint8Array,Uint8ClampedArray=e.Uint8ClampedArray,Int16Array=e.Int16Array,Uint16Array=e.Uint16Array,Int32Array=e.Int32Array,Uint32Array=e.Uint32Array,Float32Array=e.Float32Array,Float64Array=e.Float64Array,BigInt64Array=e.BigInt64Array,BigUint64Array=e.BigUint64Array}uni.restoreGlobal&&uni.restoreGlobal(Vue,weex,plus,setTimeout,clearTimeout,setInterval,clearInterval),function(e){"use strict";function t(e,t,...a){uni.__log__?uni.__log__(e,t,...a):console[e].apply(console,[...a,t])}const a={baseUrl:"http://10.10.30.249:30345",cameraImagesUrl:"/api/hkwsimage/hkwsimageByCount",timeout:1e4},r={imageInterval:6e5,timeInterval:1e3};class i{constructor(){this.baseUrl=a.baseUrl,this.timeout=a.timeout}request(e={}){return new Promise(((t,a)=>{uni.request({url:this.baseUrl+e.url,method:e.method||"GET",data:e.data||{},header:e.header||{"Content-Type":"application/json"},timeout:e.timeout||this.timeout,success:e=>{200===e.statusCode?t(e.data):a(new Error(`请求失败: ${e.statusCode}`))},fail:e=>{a(e)}})}))}get(e,t={}){return this.request({url:e,method:"GET",data:t})}post(e,t={}){return this.request({url:e,method:"POST",data:t})}}const l=new class{constructor(){this.request=new i}getCameraImages(){return this.request.post(a.cameraImagesUrl,{currentTimeStr:""})}};__definePage("pages/index/index",((e,t)=>{const a=e.__vccOpts||e;for(const[r,i]of t)a[r]=i;return a})({data:()=>({currentDateTime:"",blockList:[],refreshTimer:null,timeTimer:null}),onLoad(){this.updateDateTime(),this.fetchCameraImages(),this.timeTimer=setInterval((()=>{this.updateDateTime()}),r.timeInterval),this.refreshTimer=setInterval((()=>{this.fetchCameraImages()}),r.imageInterval)},onUnload(){this.refreshTimer&&clearInterval(this.refreshTimer),this.timeTimer&&clearInterval(this.timeTimer)},methods:{updateDateTime(){const e=new Date,t=e.getFullYear(),a=String(e.getMonth()+1).padStart(2,"0"),r=String(e.getDate()).padStart(2,"0"),i=String(e.getHours()).padStart(2,"0"),l=String(e.getMinutes()).padStart(2,"0"),n=String(e.getSeconds()).padStart(2,"0");this.currentDateTime=`${t}-${a}-${r} ${i}:${l}:${n}`},async fetchCameraImages(){try{const e=await l.getCameraImages();if(0!==e.code||!e.data)throw new Error("接口返回数据格式错误");const a=Object.keys(e.data),r=a.length;this.blockList=Array(4).fill(null).map(((t,i)=>{if(i>=r)return{isEmpty:!0};const l=a[i],n=e.data[l]||[];if(0===n.length)return{isEmpty:!0};const o=n[0]||null;let s=l;if(o&&o.devName)s=o.devName;else{const e=n.find((e=>null!=e));e&&e.devName&&(s=e.devName)}const m=["半小时前","1小时前","1.5小时前","2小时前","2.5小时前"];return{isEmpty:!1,areaName:s,mainImage:{imageUrl:(null==o?void 0:o.image)||"/static/empty-camera.png",captureTime:(null==o?void 0:o.captureTime)||this.formatTime(new Date)},leftImages:Array(2).fill(null).map(((e,t)=>{const a=n[t+1];return{imageUrl:(null==a?void 0:a.image)||"/static/empty-camera.png",captureTime:(null==a?void 0:a.captureTime)||this.formatTime(new Date),timeLabel:m[t]}})),bottomImages:Array(3).fill(null).map(((e,t)=>{const a=n[t+3];return{imageUrl:(null==a?void 0:a.image)||"/static/empty-camera.png",captureTime:(null==a?void 0:a.captureTime)||this.formatTime(new Date),timeLabel:m[t+2]}}))}})),t("log","at pages/index/index.vue:236","监控图片刷新成功:",this.currentDateTime,"实际区域数:",r)}catch(e){t("error","at pages/index/index.vue:238","获取监控图片失败:",e),this.initDefaultBlocks()}},initDefaultBlocks(){this.blockList=Array(4).fill(null).map((()=>({areaName:"生产区",mainImage:{imageUrl:"/static/default-camera.png",captureTime:this.formatTime(new Date)},leftImages:Array(2).fill(null).map(((e,t)=>({imageUrl:"/static/default-camera.png",captureTime:this.formatTime(new Date),timeLabel:.5*(t+1)+"小时前"}))),bottomImages:Array(3).fill(null).map(((e,t)=>({imageUrl:"/static/default-camera.png",captureTime:this.formatTime(new Date),timeLabel:1.5+.5*t+"小时前"})))})))},onImageError(e,t){"main"===t?this.blockList[e].mainImage.imageUrl="/static/default-camera.png":t<2?this.blockList[e].leftImages[t].imageUrl="/static/default-camera.png":this.blockList[e].bottomImages[t-2].imageUrl="/static/default-camera.png"},formatTime:e=>`${e.getFullYear()}-${String(e.getMonth()+1).padStart(2,"0")}-${String(e.getDate()).padStart(2,"0")} ${String(e.getHours()).padStart(2,"0")}:${String(e.getMinutes()).padStart(2,"0")}`}},[["render",function(t,a,r,i,l,n){return e.openBlock(),e.createElementBlock("view",{class:"container"},[e.createElementVNode("view",{class:"header"},[e.createElementVNode("view",{class:"header-bg"}),e.createElementVNode("view",{class:"header-content"},[e.createElementVNode("view",{class:"camera-info"},[e.createElementVNode("image",{class:"camera-icon",src:"/static/logo-network.png",mode:"aspectFit"}),e.createElementVNode("text",{class:"camera-text"},"捷租生态网络已覆盖")]),e.createElementVNode("view",{class:"title-wrapper"},[e.createElementVNode("view",{class:"title-line"}),e.createElementVNode("text",{class:"main-title"},"3107门神域监控"),e.createElementVNode("view",{class:"title-line"})]),e.createElementVNode("view",{class:"datetime"},[e.createElementVNode("text",{class:"datetime-text"},e.toDisplayString(l.currentDateTime),1)])])]),e.createElementVNode("view",{class:"block-grid"},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(l.blockList,((t,a)=>(e.openBlock(),e.createElementBlock("view",{class:"block-item",key:a},[t.isEmpty?(e.openBlock(),e.createElementBlock("view",{key:0,class:"empty-block"},[e.createElementVNode("image",{class:"empty-image",src:"/static/empty-camera.png",mode:"aspectFit"}),e.createElementVNode("text",{class:"empty-text"},"区域待开发")])):(e.openBlock(),e.createElementBlock("view",{key:1,class:"block-content"},[e.createElementVNode("view",{class:"top-section"},[e.createElementVNode("view",{class:"left-images"},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(t.leftImages,((r,i)=>(e.openBlock(),e.createElementBlock("view",{class:"left-image-item",key:"left-"+i},[e.createElementVNode("image",{class:"left-image grayscale",src:r.imageUrl,mode:"aspectFill",onError:e=>n.onImageError(a,i)},null,40,["src","onError"]),0===i?(e.openBlock(),e.createElementBlock("view",{key:0,class:"area-title-overlay"},[e.createElementVNode("image",{class:"tag-icon",src:"/static/title-icon.png",mode:"aspectFit"}),e.createElementVNode("text",{class:"area-title-text"},e.toDisplayString(t.areaName),1)])):e.createCommentVNode("",!0),e.createElementVNode("view",{class:"image-overlay"},[e.createElementVNode("text",{class:"image-time"},e.toDisplayString(r.captureTime),1),e.createElementVNode("view",{class:"time-badge"},e.toDisplayString(r.timeLabel),1)])])))),128))]),e.createElementVNode("view",{class:"main-image-wrapper"},[e.createElementVNode("image",{class:"main-image",src:t.mainImage.imageUrl,mode:"aspectFill",onError:e=>n.onImageError(a,"main")},null,40,["src","onError"]),e.createElementVNode("view",{class:"main-overlay"},[e.createElementVNode("view",{class:"main-time"},e.toDisplayString(t.mainImage.captureTime),1),e.createElementVNode("view",{class:"latest-badge"},"最新")]),e.createElementVNode("view",{class:"border-decoration tl"}),e.createElementVNode("view",{class:"border-decoration tr"}),e.createElementVNode("view",{class:"border-decoration bl"}),e.createElementVNode("view",{class:"border-decoration br"})])]),e.createElementVNode("view",{class:"bottom-section"},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(t.bottomImages,((t,r)=>(e.openBlock(),e.createElementBlock("view",{class:"bottom-image-item",key:"bottom-"+r},[e.createElementVNode("image",{class:"bottom-image grayscale",src:t.imageUrl,mode:"aspectFill",onError:e=>n.onImageError(a,r+2)},null,40,["src","onError"]),e.createElementVNode("view",{class:"image-overlay"},[e.createElementVNode("text",{class:"image-time"},e.toDisplayString(t.captureTime),1),e.createElementVNode("view",{class:"time-badge"},e.toDisplayString(t.timeLabel),1)])])))),128))])]))])))),128))])])}],["__scopeId","data-v-a35ffbb0"]]));const n={onLaunch:function(){t("log","at App.vue:4","App Launch"),uni.setKeepScreenOn({keepScreenOn:!0})},onShow:function(){t("log","at App.vue:11","App Show")},onHide:function(){t("log","at App.vue:14","App Hide")}};const{app:o,Vuex:s,Pinia:m}={app:e.createVueApp(n)};uni.Vuex=s,uni.Pinia=m,o.provide("__globalStyles",__uniConfig.styles),o._component.mpType="app",o._component.render=()=>{},o.mount("#app")}(Vue);
